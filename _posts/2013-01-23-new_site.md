---
layout: post
title: New Jekyll site, custom plugins, and GitHub
category: blog
tags: jekyll

type: default
short: I have a new site, developed with Jekyll. In here I describe the plugins I've hacked up so far, to get everything working nicely…

search_desc: new, site, jekyll, plugin, github
---

# {{ page.title }}

Jekyll is, according to its creators, a simple, blog aware, static site generator. It's written by one of the co-founders of GitHub, Tom Preson-Werner, and is located at [http://jekyllrb.com/](http://jekyllrb.com/)

First off, Jekyll, even for someone who doesn't like Ruby too much, is amazingly awesome. Writing up extensions is a snap (even if I do need to search up some Ruby syntax occasionally), and I really like static sites.

So, let's talk about what I did to get Jekyll working nicely for me.


## Category and Tag auto generation

I like having a nice url such as ```danneh.net/music``` for my ```music``` category (that displays all my ```music``` posts, but didn't want to need to manually make all the directories and index pages myself. I had a search around, and found that there was a prebuilt example on the [Jekyll wiki pages](https://github.com/mojombo/jekyll/wiki/Plugins) that did what I was looking for. Score!

So this is the default category generation plugin:

{% highlight ruby %}
module Jekyll

  class CategoryPage < Page
    def initialize(site, base, dir, category)
      @site = site
      @base = base
      @dir = dir
      @name = 'index.html'

      self.process(@name)
      self.read_yaml(File.join(base, '_layouts'), 'category_index.html')
      self.data['category'] = category

      category_title_prefix = site.config['category_title_prefix'] || 'Category: '
      self.data['title'] = "#{category_title_prefix}#{category}"
    end
  end

  class CategoryPageGenerator < Generator
    safe true
    
    def generate(site)
      if site.layouts.key? 'category_index'
        dir = site.config['category_dir'] || 'categories'
        site.categories.keys.each do |category|
          site.pages << CategoryPage.new(site, site.source, File.join(dir, category), category)
        end
      end
    end
  end

end
{% endhighlight %}

Fairly simple, and it works alright. However, there are a few differences that I'd like to make:

* First off, I use quite a simple structure, and only need a single layout for /all/ the autogenerated list pages (categories, tags, even the main site index), so let's use that instead of ```category_index.html```
* Rather than having everything accessed through ```danneh.net/category/<category>```, I'd rather it simply put the index page in the category's directory, like ```danneh.net/<category>``` instead.
* Finally, this only handles categories, whereas I would like it to support tags as well

So, changing to ```autogen_index.html``` is fairly simple, we just change:
{% highlight ruby %}
      self.read_yaml(File.join(base, '_layouts'), 'category_index.html')
{% endhighlight %}
to:
{% highlight ruby %}
      self.read_yaml(File.join(base, '_layouts'), 'autogen_index.html')
{% endhighlight %}

And so long as we make sure to keep using autogen.html, it should all be fine.

### Separate category folders
The second goal, having everything accessed via the category folders themselves, is as simple as changing ```dir```, the third argument for ```CategoryPage```, to the category name:

{% highlight ruby %}
        site.categories.keys.each do |category|
          site.pages << CategoryPage.new(site, site.source, category, category)
        end
{% endhighlight %}

This generates the page as ```danneh.net/<category>/index.html```, which lets us access it as simply ```danneh.net/<category>```.

### Tag index autogeneration
Our third goal, handling tags, is also crazily simple to implement. Let's take a look at that.

This part, ```TagPage``` is basically a complete copy of ```CategoryPage```. The only difference is that, similar to how the categories worked, we do actually want to access this through ```danneh.net/tags/<tag>```. We do that with the ```@dir =``` line.

{% highlight ruby %}
  class TagPage < Page
    def initialize(site, base, dir, tag)
      @site = site
      @base = base
      @dir = File.join('tags', dir)
      @name = 'index.html'

      self.process(@name)
      self.read_yaml(File.join(base, '_layouts'), 'autogen_index.html')
      self.data['tag']   = tag
      title_prefix       = site.config['tag_title_prefix'] || 'Tag: '
      self.data['title'] = "#{title_prefix}#{tag.capitalize}"
    end
  end
{% endhighlight %}

And this part is actually having the tag pages generated for each site tag, similar to how the category pages are created for each category:

{% highlight ruby %}
        site.tags.keys.each do |tag|
          site.pages << TagPage.new(site, site.source, tag, tag)
        end
{% endhighlight %}


You can find the completed code for ```page_generation.rb``` [on GitHub.](https://github.com/Danneh/danneh.github.com/blob/source/_plugins/page_generation.rb)

Now you'll notice that we don't actually put any items in these pages. That'll be handled with our pagination code.


## Pagination for categories and tags

By default, Jekyll only support pagination for the site index. You want your category and tag pages that don't have a thousand posts? Sorry, you're gonna need a custom plugin.

Now, most of the plugins for category pagination I've seen requires changing the way you call your pagination object, to a category-specific object.

The code that I based mine on, [Keith Marran's pagination code](http://www.marran.com/tech/category-pagination-in-jekyll/), doesn't look like it requires that — however, I couldn't get that working straight up, so I decided to modify the base Jekyll Pagination object myself.

Jekyll's default Pagination object is [on GitHub](https://github.com/mojombo/jekyll/blob/master/lib/jekyll/generators/pagination.rb). I decided not to include it here for size reasons.

Now, Marran's code uses a custom ```CategoryPager``` object in order to handle categories, specifically. I decided to go the route of modifying the default Pager object to search for YAML ```category``` and ```tag``` attributes, instead.

If the index you use the paginator on has ```category music```, I figure the user probably wants the music posts returned. Same as if the user has ```tag jekyll```, I figure that they want the jekyll tagged posts returned.

…To be continued


You can find the completed code for ```new_pagination.rb``` [on GitHub.](https://github.com/Danneh/danneh.github.com/blob/source/_plugins/new_pagination.rb)
